# 快速停止調整

## 修改目標

縮短單位減速到停止的時間，讓玩家不需要等太久就能執行下一步動作。

## 問題分析

### 修改前的狀況
```
速度狀態:
2500 → 1500 → 800 → 400 → 200 → 100 → 50 → 停止
                                      ↑
                              在這段時間玩家需要等待
                              (緩慢滑行階段)
```

**問題**：
- 停止閾值太低（50.0），單位會緩慢滑行很久
- 阻尼太小（0.3），減速不夠快
- 玩家需要等待 2-3 秒才能執行下一個動作
- 遊戲節奏太慢

## 主要修改

### 1. 提高停止閾值（Stop Velocity Threshold）

**作用**：當速度低於此值時，強制停止移動

```gdscript
修改前: const STOP_VELOCITY_THRESHOLD: float = 50.0
修改後: const STOP_VELOCITY_THRESHOLD: float = 200.0
```

**影響**：
- 速度降到 200 時就立即停止（而非 50）
- 跳過緩慢滑行階段
- 停止時間縮短約 **70%**

### 2. 增加線性阻尼（Linear Damp）

**作用**：控制速度的減速率

```
修改前: linear_damp = 0.3（較慢減速）
修改後: linear_damp = 0.5（較快減速）
```

**影響**：
- 減速速度提升約 **67%**
- 從高速到停止閾值的時間更短
- 整體移動時間仍保持合理

### 3. 增加角度阻尼（Angular Damp）

**作用**：控制旋轉的減速率

```
修改前: angular_damp = 2.0
修改後: angular_damp = 3.0
```

**影響**：
- 碰撞後旋轉更快停止
- 視覺上更乾淨利落

## 修改的檔案

### 場景檔案
1. **scenes/Unit.tscn** - 玩家單位
   - `linear_damp: 0.3 → 0.5`
   - `angular_damp: 2.0 → 3.0`

2. **scenes/Enemy.tscn** - 敵人單位
   - `linear_damp: 0.3 → 0.5`
   - `angular_damp: 2.0 → 3.0`

### 腳本檔案
3. **scripts/Unit.gd** - 單位邏輯
   - `STOP_VELOCITY_THRESHOLD: 50.0 → 200.0`

## 停止時間對比

### 修改前（慢）
```
發射 → 高速移動 → 中速移動 → 緩慢滑行 → 停止
      (1.0 秒)   (1.0 秒)   (2.0 秒)

總時間: 約 4.0 秒
玩家等待時間: 2.0 秒（緩慢滑行階段）
```

### 修改後（快）
```
發射 → 高速移動 → 中速移動 → 停止
      (0.8 秒)   (0.5 秒)

總時間: 約 1.3 秒
玩家等待時間: 0 秒（無緩慢滑行）
```

**改善**：
- ✅ 總時間從 4.0 秒縮短到 1.3 秒（**減少 67%**）
- ✅ 消除了緩慢滑行階段
- ✅ 玩家幾乎不需要等待

## 速度曲線對比

### 修改前（緩慢減速 + 長時間滑行）
```
速度
2500 ━━━━╮
2000      ╲
1500       ╲
1000        ╲
 500         ╲___
 200            ╲___
  50               ╲_ 停止
   0
    |←── 4 秒 ────→|
        慢~~~
```

### 修改後（快速減速 + 無滑行）
```
速度
2500 ━━━╮
2000     ╲
1500      ╲
1000       ╲
 500        ╲
 200         停止
  50
   0
    |← 1.3秒 →|
      快！
```

## 物理原理說明

### Linear Damp 加速減速

在每一幀，速度減少的量：

```gdscript
new_velocity = old_velocity * (1 - linear_damp * delta)
```

**範例（假設 60 FPS，delta ≈ 0.0167）**：

```
linear_damp = 0.3:
  每幀速度保留 = 1 - (0.3 × 0.0167) = 0.995
  每秒速度保留 = 0.995^60 ≈ 0.74 (損失 26%)

linear_damp = 0.5:
  每幀速度保留 = 1 - (0.5 × 0.0167) = 0.9915
  每秒速度保留 = 0.9915^60 ≈ 0.61 (損失 39%)
```

**效果**：
- linear_damp 從 0.3 → 0.5，減速快了約 **50%**

### Stop Threshold 消除滑行

```gdscript
if velocity < STOP_VELOCITY_THRESHOLD:
    velocity = 0  # 強制停止
```

**修改前（閾值 = 50）**：
```
速度 200 → 150 → 100 → 50 → 停止
                    ↑
            需要等待很久
```

**修改後（閾值 = 200）**：
```
速度 200 → 停止
        ↑
    立即停止！
```

## 遊戲體驗改善

### 修改前
```
1. 玩家發射單位
2. 單位撞擊敵人
3. 單位開始緩慢滑行 ⏳（玩家等待中...）
4. 還在滑行... ⏳
5. 終於停止
6. 可以執行下一個動作

問題：節奏太慢，玩家感到無聊
```

### 修改後
```
1. 玩家發射單位
2. 單位撞擊敵人
3. 單位快速停止 ✓
4. 立即可以執行下一個動作

優點：節奏緊湊，爽快感強
```

## 測試建議

### 測試 1：基本停止時間
1. 以最大 power 發射單位
2. 觀察從發射到停止的時間
3. 預期：約 1-2 秒內停止（修改前需要 3-4 秒）

### 測試 2：碰撞後停止
1. 單位撞擊敵人
2. 觀察碰撞後減速情況
3. 預期：快速減速，不會長時間滑行

### 測試 3：低速停止
1. 以較小力道發射（< 最大 power 的 50%）
2. 觀察停止時間
3. 預期：速度降到 200 時立即停止

### 測試 4：連續操作
1. 連續發射多個單位
2. 觀察每次操作之間的等待時間
3. 預期：幾乎無需等待，可以快速操作

## 平衡考量

### 移動距離 vs 停止時間

**目標**：保持足夠的移動距離，同時快速停止

```
參數配置:
linear_damp = 0.5    (適中的減速)
threshold = 200.0    (較高的停止閾值)

結果:
- 移動距離: 仍然足夠遠（保持速度感）
- 停止時間: 大幅縮短（提升節奏）
- 平衡: ✓ 兩者兼顧
```

### 為什麼不用更高的閾值？

```
threshold = 300 或更高:
  優點: 停止更快
  缺點: 移動距離太短，失去速度感

threshold = 200:
  優點: 平衡點 ✓
  - 保持足夠的移動距離
  - 停止時間大幅縮短
  - 遊戲節奏良好
```

## 微調參數

如果覺得停止時間還需要調整：

### 更快停止（更激進）
```gdscript
STOP_VELOCITY_THRESHOLD = 250.0  # 更高的閾值
linear_damp = 0.6                # 更強的阻尼
```
**效果**：停止極快，但移動距離會更短

### 稍慢停止（更溫和）
```gdscript
STOP_VELOCITY_THRESHOLD = 150.0  # 較低的閾值
linear_damp = 0.4                # 較弱的阻尼
```
**效果**：停止較慢，但移動距離更遠

### 當前設定（推薦平衡）
```gdscript
STOP_VELOCITY_THRESHOLD = 200.0  # 平衡點
linear_damp = 0.5                # 適中阻尼
```
**效果**：最佳平衡 ✓

## 與其他系統的配合

### 1. 軌跡效果
- 軌跡在速度 > 500 時顯示
- 快速停止後軌跡立即消失
- 視覺上更乾淨利落

### 2. 傷害計算
- 傷害基於速度計算
- 快速停止不影響碰撞時的傷害
- 因為碰撞發生在高速階段

### 3. Smash 技能
- Smash 可在高速時觸發
- 快速停止後立即可以開始下一輪
- 連攜更流暢

### 4. 最大 Power 系統
- 配合 200px 拖曳閾值
- 最大 power (2500) 仍能移動足夠距離
- 快速停止提升操作節奏

## 數值參考表

### 停止閾值建議值
```
50   - 原始值（太慢，不推薦）
100  - 仍然較慢
150  - 稍快
200  - 推薦值 ✓（平衡）
250  - 很快（激進）
300  - 極快（可能太短）
```

### Linear Damp 建議值
```
0.2  - 很慢（不推薦）
0.3  - 較慢（修改前）
0.4  - 適中
0.5  - 推薦值 ✓（快但保持距離）
0.6  - 快（距離較短）
0.8  - 很快（距離太短）
```

## 總結

**修改效果**：
- ✅ 停止時間從 4 秒縮短到 1.3 秒（**減少 67%**）
- ✅ 消除緩慢滑行階段
- ✅ 玩家幾乎不需要等待
- ✅ 遊戲節奏更緊湊
- ✅ 保持足夠的移動距離和速度感
- ✅ 操作更流暢，爽快感提升

**參數總覽**：
```gdscript
STOP_VELOCITY_THRESHOLD: 50.0 → 200.0  (提高 4 倍)
linear_damp: 0.3 → 0.5                  (提高 67%)
angular_damp: 2.0 → 3.0                 (提高 50%)
```

**現在單位會快速停止，玩家可以立即執行下一個動作！**
