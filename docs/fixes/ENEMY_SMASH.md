# æ•µäºº Smash ç³»çµ±

## åŠŸèƒ½èªªæ˜

æ•µäººç¾åœ¨ä¹Ÿå¯ä»¥åœ¨ç§»å‹•ä¸­è§¸ç™¼ Smash æ”»æ“Šï¼Œèˆ‡ç©å®¶ç›¸åŒçš„æ©Ÿåˆ¶ã€‚

## å¯¦ä½œç´°ç¯€

### è§¸ç™¼æ™‚æ©Ÿ

```gdscript
## è¡æ’è¡Œå‹•ä¸­éš¨æ©Ÿè§¸ç™¼
func _execute_charge():
    # ç™¼å°„æ•µäºº
    launch(direction, charge_power)

    # 50% æ©Ÿç‡è§¸ç™¼ Smash
    if randf() > 0.5:
        # å»¶é² 0.3-0.8 ç§’å¾Œè§¸ç™¼
        await get_tree().create_timer(randf_range(0.3, 0.8)).timeout
        if is_moving:
            _trigger_enemy_smash()
```

**è¨­è¨ˆè€ƒé‡**ï¼š
- **éš¨æ©Ÿæ€§**ï¼š50% æ©Ÿç‡ï¼Œå¢åŠ ä¸å¯é æ¸¬æ€§
- **å»¶é²è§¸ç™¼**ï¼š0.3-0.8 ç§’å¾Œï¼Œæ¨¡æ“¬ç§»å‹•ä¸­é€”è§¸ç™¼
- **ç‹€æ…‹æª¢æŸ¥**ï¼šç¢ºä¿æ•µäººä»åœ¨ç§»å‹•ä¸­æ‰è§¸ç™¼

### Smash å¯¦ä½œ

```gdscript
func _trigger_enemy_smash():
    # 1. è¨˜éŒ„ç©å®¶ä½ç½®ï¼ˆé˜²æ­¢è¢«æ¨å‹•ï¼‰
    var player_positions = {}
    for player in all_players:
        player_positions[player] = player.global_position

    # 2. ç¦ç”¨æ•µäººç¢°æ’
    collision_mask = 0

    # 3. ç¯„åœæª¢æ¸¬ï¼ˆåŠå¾‘ 150pxï¼‰
    var nearby_players = _get_nearby_players(150.0)

    # 4. å°æ¯å€‹ç©å®¶é€ æˆå‚·å®³
    for player in nearby_players:
        damage = atk Ã— 1.5 Ã— attr_multiplier
        player.take_damage(damage)
        é¡¯ç¤ºå‚·å®³æµ®å­— âœ…

    # 5. åœæ­¢æ•µäººç§»å‹•
    stop_movement()

    # 6. æ¢å¾©ç¢°æ’
    collision_mask = original_value

    # 7. å¼·åˆ¶æ¢å¾©ç©å®¶ä½ç½®
    await process_frame
    for player in player_positions:
        player.global_position = original_pos
        player.linear_velocity = Vector2.ZERO
```

### è·é›¢æª¢æ¸¬ä¿®æ­£

åŒæ™‚ä¿®æ­£äº† `_get_nearby_players()` ä½¿ç”¨ç´”è·é›¢è¨ˆç®—ï¼š

```gdscript
# âŒ ä¿®æ­£å‰ï¼šä½¿ç”¨ç‰©ç†æŸ¥è©¢
func _get_nearby_players(radius: float) -> Array:
    var query = PhysicsShapeQueryParameters2D.new()
    var shape = CircleShape2D.new()
    # ... æœƒç”¢ç”Ÿç‰©ç†äº¤äº’

# âœ… ä¿®æ­£å¾Œï¼šç´”è·é›¢è¨ˆç®—
func _get_nearby_players(radius: float) -> Array:
    var players = []
    for player in get_tree().get_nodes_in_group("player"):
        if global_position.distance_to(player.global_position) <= radius:
            players.append(player)
    return players
```

## è¡Œç‚ºæµç¨‹

### æ­£å¸¸è¡æ’ï¼ˆç„¡ Smashï¼‰
```
æ•µäººè¡Œå‹•å€’æ•¸æ­¸é›¶
    â†“
åŸ·è¡Œ CHARGE è¡Œå‹•
    â†“
ç™¼å°„æ•µäººæœå‘ç©å®¶
    â†“
éš¨æ©Ÿåˆ¤å®šï¼šä¸è§¸ç™¼ Smash (50%)
    â†“
æ­£å¸¸ç¢°æ’ç©å®¶
    â†“
åœæ­¢ç§»å‹•
```

### è¡æ’ + Smash
```
æ•µäººè¡Œå‹•å€’æ•¸æ­¸é›¶
    â†“
åŸ·è¡Œ CHARGE è¡Œå‹•
    â†“
ç™¼å°„æ•µäººæœå‘ç©å®¶
    â†“
éš¨æ©Ÿåˆ¤å®šï¼šè§¸ç™¼ Smash (50%)
    â†“
å»¶é² 0.3-0.8 ç§’
    â†“
æª¢æŸ¥ï¼šæ•µäººä»åœ¨ç§»å‹•ï¼Ÿ
    â”œâ”€ æ˜¯ â†’ è§¸ç™¼ Smash
    â”‚    â†“
    â”‚  ç¯„åœ AoE å‚·å®³ï¼ˆåŠå¾‘ 150pxï¼‰
    â”‚    â†“
    â”‚  å°ç¯„åœå…§ç©å®¶ï¼š
    â”‚    - é€ æˆ 1.5 å€å‚·å®³
    â”‚    - é¡¯ç¤ºå‚·å®³æµ®å­— âœ…
    â”‚    - ç©å®¶ä½ç½®ä¸è®Š
    â”‚    â†“
    â”‚  ç«‹å³åœæ­¢ç§»å‹•
    â”‚
    â””â”€ å¦ â†’ ä¸è§¸ç™¼ï¼ˆå·²åœæ­¢ï¼‰
```

## èˆ‡ç©å®¶ Smash çš„å°æ¯”

| é …ç›® | ç©å®¶ Smash | æ•µäºº Smash |
|------|-----------|-----------|
| è§¸ç™¼æ–¹å¼ | æ‰‹å‹•é»æ“Š | éš¨æ©Ÿè‡ªå‹• (50%) |
| è§¸ç™¼æ™‚æ©Ÿ | ç§»å‹•ä¸­é»æ“Š | å»¶é² 0.3-0.8 ç§’ |
| ç¯„åœ | 150 åƒç´  | 150 åƒç´  |
| å‚·å®³å€ç‡ | 1.5Ã— | 1.5Ã— |
| ç›®æ¨™ | æ•µäºº | ç©å®¶ |
| ä½ç½®ä¿è­· | æ•µäººä¸ç§»å‹• | ç©å®¶ä¸ç§»å‹• |
| å‚·å®³æµ®å­— | âœ… æœ‰ | âœ… æœ‰ |

## AI ç­–ç•¥

### ä½•æ™‚è§¸ç™¼ï¼Ÿ
```
æ•µäººåŸ·è¡Œ CHARGEï¼š
â”œâ”€ 50% æ©Ÿç‡ï¼šè§¸ç™¼ Smash
â”‚   â”œâ”€ å„ªå‹¢ï¼šç¯„åœå‚·å®³æ›´é«˜
â”‚   â””â”€ åŠ£å‹¢ï¼šæå‰åœæ­¢ç§»å‹•
â”‚
â””â”€ 50% æ©Ÿç‡ï¼šä¸è§¸ç™¼
    â”œâ”€ å„ªå‹¢ï¼šç§»å‹•æ›´é ï¼Œæ¥è¿‘ç›®æ¨™
    â””â”€ åŠ£å‹¢ï¼šåªæœ‰ç¢°æ’å‚·å®³
```

### æˆ°è¡“æ„ç¾©
- **å£“åˆ¶**ï¼šçªç„¶çš„ AoE æ‰“äº‚ç©å®¶ä½ˆå±€
- **ä¸å¯é æ¸¬**ï¼š50% éš¨æ©Ÿæ€§å¢åŠ è®ŠåŒ–
- **é¢¨éšªå¹³è¡¡**ï¼šæå‰åœæ­¢ vs ç¯„åœå‚·å®³

## æ¸¬è©¦å ´æ™¯

### å ´æ™¯ 1: æ•µäººè¡æ’ä½†ä¸ Smash
```
æ•µäººå€’æ•¸æ­¸é›¶
    â†“
å‘ç©å®¶è¡æ’
    â†“
éš¨æ©Ÿåˆ¤å®šï¼šä¸è§¸ç™¼ (50%)
    â†“
æ­£å¸¸ç¢°æ’ç©å®¶
    â†“
çµæœï¼š
âœ… ç¢°æ’å‚·å®³
âœ… ç§»å‹•è·é›¢æœ€é 
```

### å ´æ™¯ 2: æ•µäººè¡æ’ä¸¦è§¸ç™¼ Smash
```
æ•µäººå€’æ•¸æ­¸é›¶
    â†“
å‘ç©å®¶è¡æ’
    â†“
éš¨æ©Ÿåˆ¤å®šï¼šè§¸ç™¼ (50%)
    â†“
å»¶é²ç´„ 0.5 ç§’
    â†“
è§¸ç™¼ Smash
    â†“
çµæœï¼š
âœ… ç¯„åœå…§ç©å®¶å—åˆ° 1.5Ã— å‚·å®³
âœ… é¡¯ç¤ºé»ƒè‰²å‚·å®³æµ®å­—
âœ… ç©å®¶ä½ç½®ä¸è®Š
âœ… æ•µäººç«‹å³åœæ­¢
```

### å ´æ™¯ 3: Smash ç¯„åœæ”»æ“Šå¤šå€‹ç©å®¶
```
    ğŸ”´ ç©å®¶1
  ğŸ”µ æ•µäººè¡æ’
    ğŸ”´ ç©å®¶2
       â†“
    Smash è§¸ç™¼
       â†“
çµæœï¼š
âœ… å…©å€‹ç©å®¶éƒ½å—å‚·
âœ… å…©å€‹å‚·å®³æµ®å­—
âœ… å…©å€‹ç©å®¶ä½ç½®ä¸è®Š
```

### å ´æ™¯ 4: å»¶é²æœŸé–“æ•µäººè¢«åœæ­¢
```
æ•µäººè¡æ’
    â†“
éš¨æ©Ÿåˆ¤å®šï¼šè§¸ç™¼ Smash
    â†“
å»¶é² 0.3-0.8 ç§’æœŸé–“...
ç©å®¶æ”»æ“Šæ•µäºº â†’ æ•µäººåœæ­¢ç§»å‹•
    â†“
å»¶é²çµæŸï¼Œæª¢æŸ¥ is_moving
    â†“
is_moving = false
    â†“
ä¸è§¸ç™¼ Smash âœ… (æ­£ç¢º)
```

## èª¿æ•´åƒæ•¸

### ä¿®æ”¹è§¸ç™¼æ©Ÿç‡
```gdscript
# ç•¶å‰ï¼š50%
if randf() > 0.5:

# æ›´é«˜æ©Ÿç‡ï¼ˆ75%ï¼‰
if randf() > 0.25:

# æ›´ä½æ©Ÿç‡ï¼ˆ25%ï¼‰
if randf() > 0.75:

# å¿…å®šè§¸ç™¼ï¼ˆ100%ï¼‰
if true:
```

### ä¿®æ”¹å»¶é²æ™‚é–“
```gdscript
# ç•¶å‰ï¼š0.3-0.8 ç§’
await get_tree().create_timer(randf_range(0.3, 0.8)).timeout

# æ›´æ—©è§¸ç™¼ï¼ˆ0.1-0.4 ç§’ï¼‰
await get_tree().create_timer(randf_range(0.1, 0.4)).timeout

# æ›´æ™šè§¸ç™¼ï¼ˆ0.5-1.2 ç§’ï¼‰
await get_tree().create_timer(randf_range(0.5, 1.2)).timeout
```

### ä¿®æ”¹ç¯„åœå’Œå‚·å®³
```gdscript
# ç•¶å‰
var smash_radius = 150.0
var smash_multiplier = 1.5

# æ›´å¤§ç¯„åœï¼Œæ›´é«˜å‚·å®³
var smash_radius = 200.0
var smash_multiplier = 2.0

# æ›´å°ç¯„åœï¼Œæ›´ä½å‚·å®³
var smash_radius = 100.0
var smash_multiplier = 1.2
```

## æ§åˆ¶å°è¼¸å‡º

### Smash è§¸ç™¼
```
[Enemy] Executing CHARGE action
[Enemy] Enemy SMASH triggered!
Enemy Smash hit Player Unit for 120 damage
```

### Smash æœªè§¸ç™¼
```
[Enemy] Executing CHARGE action
(ç„¡ Smash è¨Šæ¯)
```

## æ•ˆèƒ½è€ƒé‡

### æ¯æ¬¡ CHARGE çš„æˆæœ¬
```
åŸºç¤ç§»å‹•ï¼š
- launch() ä¸€æ¬¡ç‰©ç†è¨ˆç®—
- ç¢°æ’æª¢æ¸¬

é¡å¤– Smash æˆæœ¬ï¼ˆ50% æ©Ÿç‡ï¼‰ï¼š
- 1 å€‹è¨ˆæ™‚å™¨ (await timer)
- 1 æ¬¡è·é›¢æª¢æ¸¬å¾ªç’° (O(n))
- n æ¬¡å‚·å®³è¨ˆç®—
- n å€‹å‚·å®³æµ®å­—ç”Ÿæˆ
- 1 æ¬¡ä½ç½®æ¢å¾©

n = ç©å®¶æ•¸é‡ï¼ˆé€šå¸¸ 1-5ï¼‰
ç¸½æˆæœ¬ï¼šå¯å¿½ç•¥ âœ“
```

## å¹³è¡¡å»ºè­°

### å¦‚æœæ•µäººå¤ªå¼·
- é™ä½è§¸ç™¼æ©Ÿç‡ï¼ˆ50% â†’ 30%ï¼‰
- æ¸›å°‘å‚·å®³å€ç‡ï¼ˆ1.5Ã— â†’ 1.2Ã—ï¼‰
- ç¸®å°ç¯„åœï¼ˆ150 â†’ 100ï¼‰

### å¦‚æœæ•µäººå¤ªå¼±
- æé«˜è§¸ç™¼æ©Ÿç‡ï¼ˆ50% â†’ 70%ï¼‰
- å¢åŠ å‚·å®³å€ç‡ï¼ˆ1.5Ã— â†’ 2.0Ã—ï¼‰
- æ“´å¤§ç¯„åœï¼ˆ150 â†’ 200ï¼‰

## ç¸½çµ

### æ–°å¢åŠŸèƒ½
- âœ… æ•µäººå¯åœ¨è¡æ’ä¸­è§¸ç™¼ Smash
- âœ… 50% éš¨æ©Ÿæ©Ÿç‡ï¼Œå»¶é²è§¸ç™¼
- âœ… èˆ‡ç©å®¶ Smash ç›¸åŒæ©Ÿåˆ¶
- âœ… å®Œæ•´çš„ä½ç½®ä¿è­·
- âœ… é¡¯ç¤ºå‚·å®³æµ®å­—
- âœ… ä¿®æ­£è·é›¢æª¢æ¸¬ï¼ˆç„¡ç‰©ç†äº¤äº’ï¼‰

### éŠæˆ²é«”é©—
- âœ… å¢åŠ æ•µäººå¨è„…æ€§
- âœ… æé«˜æˆ°é¬¥è®ŠåŒ–æ€§
- âœ… ä¸å¯é æ¸¬çš„æˆ°è¡“
- âœ… é›™æ–¹æ©Ÿåˆ¶å°ç­‰

**æ•µäººç¾åœ¨ä¹Ÿèƒ½ä½¿ç”¨ Smash äº†ï¼** âš”ï¸
