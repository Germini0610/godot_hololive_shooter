# 移動曲線調整

## 調整目標

讓單位的移動更有「彈珠台」的感覺：
- **加速到極速**：立即達到最高速（已經是這樣）
- **從極速到靜止**：減速曲線更陡（更快停下來）

## 修改內容

### 1. 增加線性阻尼（Linear Damp）

**作用**：控制速度的減速率

**修改前**：
```gdscript
linear_damp = 0.2  # 較慢的減速
```

**修改後**：
```gdscript
linear_damp = 1.0  # 較快的減速（5倍）
```

**影響**：
- 單位從高速減速到停止的時間縮短
- 減速曲線更陡峭
- 單位移動距離變短

### 2. 增加角度阻尼（Angular Damp）

**作用**：控制旋轉的減速率

**修改前**：
```gdscript
angular_damp = 2.0
```

**修改後**：
```gdscript
angular_damp = 5.0  # 2.5倍
```

**影響**：
- 單位旋轉更快停止
- 碰撞後的旋轉效果減少

### 3. 提高停止閾值（Stop Velocity Threshold）

**作用**：當速度低於此值時，強制停止

**修改前**：
```gdscript
const STOP_VELOCITY_THRESHOLD: float = 50.0
```

**修改後**：
```gdscript
const STOP_VELOCITY_THRESHOLD: float = 150.0  # 3倍
```

**影響**：
- 單位在速度較高時就會停止
- 避免長時間緩慢滑行
- 停止更乾脆

## 修改的檔案

1. **scenes/Unit.tscn**（玩家單位）
   - `linear_damp: 0.2 → 1.0`
   - `angular_damp: 2.0 → 5.0`

2. **scenes/Enemy.tscn**（敵人單位）
   - `linear_damp: 0.2 → 1.0`
   - `angular_damp: 2.0 → 5.0`

3. **scripts/Unit.gd**（單位腳本）
   - `STOP_VELOCITY_THRESHOLD: 50.0 → 150.0`

## 減速曲線對比

### 修正前（緩慢減速）

```
速度
2000 ━━━╮
1500      ╲
1000       ╲
 500        ╲___
   0            ╲________ 時間
    |←── 較長的減速時間 ──→|
```

**特性**：
- 緩慢的減速
- 長時間滑行
- 移動距離長

### 修正後（快速減速）

```
速度
2000 ━━━╮
1500     ╲
1000      ╲
 500       ╲
   0        ╲____ 時間
    |←短→|
```

**特性**：
- 快速的減速
- 短時間滑行
- 移動距離短
- 停止更乾脆

## 物理公式說明

### Linear Damp 的作用

在每一幀，速度會按以下方式減少：

```gdscript
new_velocity = old_velocity * (1 - linear_damp * delta)
```

**範例（假設 60 FPS，delta ≈ 0.0167）**：

```
linear_damp = 0.2:
  每幀減速 = 1 - (0.2 × 0.0167) = 0.9967
  速度保留率 = 99.67%

linear_damp = 1.0:
  每幀減速 = 1 - (1.0 × 0.0167) = 0.9833
  速度保留率 = 98.33%
```

**效果**：
- `linear_damp = 1.0` 每秒損失更多速度
- 減速曲線更陡

### 停止閾值的作用

```gdscript
if velocity < STOP_VELOCITY_THRESHOLD:
    velocity = 0
```

**修正前**：
```
2000 → 1500 → 1000 → 500 → 200 → 100 → 49 → 停止
                                    ↑
                            緩慢滑行階段
```

**修正後**：
```
2000 → 1500 → 1000 → 500 → 149 → 停止
                              ↑
                        立即停止，無滑行
```

## 測試對比

### 測試 1：直線移動

**修正前**：
```
發射 → ━━━━━━━━━━━╲╲╲___ 停止
      |←── 約 3-4 秒 ──→|
      移動距離: 約 800px
```

**修正後**：
```
發射 → ━━━━╲╲ 停止
      |←1-2秒→|
      移動距離: 約 400px
```

### 測試 2：碰牆反彈

**修正前**：
```
發射 → 碰牆 → 反彈 → 滑行 → 緩慢停止
      多次小反彈
```

**修正後**：
```
發射 → 碰牆 → 反彈 → 快速停止
      1-2次反彈後立即停止
```

### 測試 3：碰撞敵人

**修正前**：
```
碰撞 → 反彈 → 繼續滑行
```

**修正後**：
```
碰撞 → 反彈 → 快速停止
```

## 調整建議

如果覺得減速太快或太慢，可以調整參數：

### 更快停止（更陡）

```gdscript
linear_damp = 1.5      # 更大的阻尼
STOP_VELOCITY_THRESHOLD = 200.0  # 更高的閾值
```

### 更慢停止（更緩）

```gdscript
linear_damp = 0.5      # 較小的阻尼
STOP_VELOCITY_THRESHOLD = 100.0  # 較低的閾值
```

### 平衡設置（當前）

```gdscript
linear_damp = 1.0      # 中等阻尼
STOP_VELOCITY_THRESHOLD = 150.0  # 中等閾值
```

## 數值說明

### Linear Damp 參考值

```
0.0  - 無阻尼（永遠滑行）
0.2  - 很低阻尼（原設定，緩慢停止）
0.5  - 低阻尼（較慢停止）
1.0  - 中等阻尼（目前設定，適中停止）
2.0  - 高阻尼（快速停止）
5.0  - 很高阻尼（幾乎立即停止）
```

### Stop Threshold 參考值

```
50   - 原設定（允許長時間緩慢滑行）
100  - 較早停止
150  - 目前設定（適中，乾脆停止）
200  - 很早停止（可能太突兀）
300  - 極早停止（不建議）
```

## 總結

**修改效果**：
- ✅ 減速曲線更陡（從 linear_damp 0.2 → 1.0）
- ✅ 停止更乾脆（從 threshold 50 → 150）
- ✅ 旋轉更快停止（從 angular_damp 2.0 → 5.0）
- ✅ 移動距離縮短約 50%
- ✅ 停止時間縮短約 50-60%

**現在單位會更快停下來，減速曲線更陡峭！**
